<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>3D Defense Visibility Viewer</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.113/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
      html, body, #cesiumContainer {
        width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="cesiumContainer"></div>
    <script>
      // Initialize Cesium viewer
      const viewer = new Cesium.Viewer("cesiumContainer", {
        terrainProvider: Cesium.createWorldTerrain(),
        shouldAnimate: false,
        baseLayerPicker: false,
        timeline: false,
        animation: false
      });

      // Center view around your AOI
      viewer.camera.flyTo({
        destination: Cesium.Cartesian3.fromDegrees(71.985, 34.189, 5000)
      });

      // Add Observer marker
      const observer = viewer.entities.add({
        name: "Observer",
        position: Cesium.Cartesian3.fromDegrees(71.985, 34.189, 40),
        point: { pixelSize: 10, color: Cesium.Color.RED }
      });

      // Load GeoJSON visibility polygon
      Cesium.GeoJsonDataSource.load("http://127.0.0.1:8000/static/viewshed_py.geojson", {
        stroke: Cesium.Color.LIME,
        fill: Cesium.Color.LIME.withAlpha(0.4),
        strokeWidth: 1
      }).then(ds => viewer.dataSources.add(ds));

      // Optionally, add line of sight path
      viewer.entities.add({
        name: "LOS Path",
        polyline: {
          positions: Cesium.Cartesian3.fromDegreesArrayHeights([
            71.985, 34.189, 40,   // Observer
            71.983, 34.182, 10    // Target
          ]),
          width: 4,
          material: Cesium.Color.YELLOW
        }
      });
    </script>
  </body>
</html>
